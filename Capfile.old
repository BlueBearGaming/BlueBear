load 'deploy' if respond_to?(:namespace) # cap2 differentiator

require 'capifony_symfony2'

# staging
set :stages, %w(staging)
set :default_stage, "staging"
set :stage_dir,     "app/config/capifony"

require 'capistrano/ext/multistage'

# application
set :application, "BlueBear"
set :app_path, "app"

# deployment
set :use_sudo, false
set :controllers_to_clear, ['app_*.php']
set :writable_dirs, ["app/cache", "app/logs", "web/uploads", "web/uploads/media"]
set :webserver_user, "www-data"

#Â symfony
set :dump_assetic_assets, true
set :shared_files, ["app/config/parameters.yml"]
set :shared_children, [app_path + "/logs", web_path + "/uploads", "vendor"]
set :model_manager, "doctrine"

# composer
set :use_composer, true
set :composer_options,  "--verbose --prefer-dist --optimize-autoloader --no-progress"
set :update_vendors, false

# scm method
set :repository,  "https://git@github.com/CleverGaming/BlueBear.git"
set :scm,  :git
set :deploy_via, :remote_cache

#set :keep_releases,  5
after "deploy:update", "deploy:cleanup"